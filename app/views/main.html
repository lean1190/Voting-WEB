<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
</head>

<body>

    <!--Tabs-->
    <ul class="tabset">
        <li role="presentation" class="active" ng-click="findPosts('Todos')">TODOS</li>
        <li ng-repeat="category in categories" ng-click="findPosts(category.value)" ng-bind="category.title" role="presentation"></li>
    </ul>

    <!-- ===== Formulario para la creación de posts
        Todo es más fácil de acomodar si está dentro de un div :)
    -->
    <div class="create-post-wrapper" ng-show="user">
        <div class="create-post-user-image-wrapper">
            <img ng-src="{{ user.image }}" alt="Imagen de perfil" />
        </div>
        <div class="create-post-form-wrapper">
            <form class="clearfix" ng-submit="addPost()">
                <fieldset>
                    <!-- Cada campo a completar se encuentra dentro de un div con la clase .form-group -->

                    <div class="form-group">
                        <label class="control-label sr-only" for="txtTitle">Un t&iacute;tulo para el post</label>
                        <input id="txtTitle" name="txtTitle" type="text" class="form-control input-md" placeholder="Un t&iacute;tulo para el post" ng-model="article.title" required>
                    </div>

                    <div class="form-group">
                        <label class="control-label sr-only" for="txtPost">¿Qu&eacute; te gustar&iacute;a que se vote?</label>
                        <textarea class="form-control" id="txtPost" name="txtPost" placeholder="¿Qu&eacute; te gustar&iacute;a que se vote?" ng-model="article.post" required></textarea>
                    </div>
                    <div class="form-group">
                        <select name="category" id="selectCategory" ng-model="article.category" class="form-control">
                            <option value="">-- Categor&iacute;a --</option>
                            <option ng-repeat="category in categories" value="category.value" ng-bind="category.title"></option>
                        </select>
                    </div>
                </fieldset>
                <input id="send-post-button" ng-disabled="!article.title || !article.post || !user" class="btn btn-warning" type="submit" value="Publicar" />
            </form>
        </div>
        <div class="create-post-caret"></div>
    </div>

    <!-- Spinner que se muestra mientras los posts no se recuperaron -->
    <spinner class="posts-loading-spinner" name="postsSpinner" img-src="images/loading.gif" show="busy"></spinner>

    <!-- ===== Listado de posts activos
        Conviene separar las distintas secciones del sitio en divs fácilmente
        diferenciables y no dependientes. De esta forma, al listado de posts no
        le importa cómo se despliega el formulario de creación, y viceversa.

        A su vez, cada post se encuentra dentro de un div con la clase .list-group.
    -->
    <div class="posts-wrapper">
        <ul class="list-group">
            <!--Infinite scroll-->
            <div infinite-scroll='loadMore()' infinite-scroll-distance='2' infinite-scroll-immediate-check='false' infinite-scroll-disabled='busy'>
                <li class="list-group-item post" dir-paginate="article in articles | filter: { show:true } | orderBy:['-likes', 'timestamp'] | filter:search | itemsPerPage: pageSize" current-page="currentPage">

                    <span class="post-crud-buttons pull-right">
                        <button ng-hide="article.owner !== user.facebookId" ng-click="editing = true; post = article.post" type="submit" title="Editar">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <delete-post-button post-id="{{::article.$id}}" post-owner="{{::article.owner}}" ng-show="article.owner === user.facebookId"></delete-post-button>
                    </span>

                    <!--
                        Esta clase .clearfix que viene con Bootstrap, limpia los floats,
                        lo que hace que no se pegue un mambo copado con los tamaños de los divs,
                        así logramos no tener que hacer parches de width, height y esas cosas cochinas.
                    -->
                    <div class="clearfix">
                        <div class="post-image">
                            <img ng-src="{{article.photo}}" alt="" />
                        </div>
                        <div class="post-content">
                            <h4 class="list-group-item-heading">
                                <strong class="post-title">{{article.title}}</strong>
                                <span class="post-time">- {{::article.timestamp | TwitterLikeDate}}</span>
                            </h4>
                            <p ng-hide="editing" class="list-group-item-text post-body-content">{{article.post}}</p>
                            <form ng-show="editing" ng-submit="editing = false">
                                <input type="text" ng-model="article.post" placeholder="Post" required/>
                                <br/>
                                <button ng-click="edit(article.$id, article.post)" class="btn" type="submit">Save</button>
                                <button ng-click="article.post = post" class="btn" type="submit">Cancel</button>
                            </form>
                        </div>
                    </div>

                    <div class="post-actions clearfix">
                        <div class="list-group-item-text pull-left">
                            <div class="post-not-done" ng-show="!article.done">
                                <span class="label label-warning">Pendiente</span>
                                <a href="#/" class="btn-xs" ng-click="markDone(article.$id, article.owner)" ng-show="article.owner === user.facebookId">
                                    <i class="fa fa-check"></i> Ya se hizo!
                                </a>
                            </div>
                            <div class="post-not-done" ng-show="article.done">
                                <span class="label label-success">Hecho!</span>
                                <a href="#/" class="btn-xs" ng-click="markNotDone(article.$id, article.owner)" ng-show="article.owner === user.facebookId">
                                    <i class="fa fa-times"></i> Está pendiente
                                </a>
                            </div>
                        </div>
                        <div class="pull-right">
                            <button class="btn btn-xs add-like-post-button" ng-click="addLike(article.$id, user.facebookId)" ng-disabled="postWasLikedBy(article, user.facebookId)">+1</button> {{article.likes}}
                            <!-- !user || postWasLikedBy(article, user.facebookId) -->
                        </div>
                    </div>

                </li>

            </div>
        </ul>

        <!--<dir-pagination-controls boundary-links="false"></dir-pagination-controls>-->

        </div>

</body>

</html>
